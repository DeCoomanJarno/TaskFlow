<div class="app-wrapper" [class.compact-mode]="appSettings.compactMode">
  <mat-toolbar class="app-toolbar">
    <div class="toolbar-content">
      <div class="brand">
        <mat-icon class="brand-icon">dashboard</mat-icon>
        <span class="brand-name">TaskFlow</span>
      </div>

      <div class="nav-tabs">
        <button
          mat-button
          class="nav-tab"
          [class.active]="currentView === 'tasks'"
          (click)="switchView('tasks')">
          <mat-icon>task</mat-icon>
          <span>Tasks</span>
        </button>
        <button
          mat-button
          class="nav-tab"
          [class.active]="currentView === 'users'"
          (click)="switchView('users')">
          <mat-icon>people</mat-icon>
          <span>Users</span>
        </button>
      </div>

      <div class="toolbar-actions">
        <button
          mat-icon-button
          class="toolbar-icon"
          [class.active]="currentView === 'analytics'"
          title="Analytics"
          aria-label="Analytics"
          (click)="switchView('analytics')">
          <mat-icon>insights</mat-icon>
        </button>
        <button
          mat-icon-button
          class="toolbar-icon"
          [class.active]="currentView === 'settings'"
          title="Settings"
          aria-label="Settings"
          (click)="switchView('settings')">
          <mat-icon>settings</mat-icon>
        </button>
        @if (currentUser$ | async; as user) {
          <button mat-stroked-button class="toolbar-login" (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>{{ user.name }}</span>
          </button>
        } @else {
          <button mat-stroked-button class="toolbar-login" (click)="openLogin()">
            <mat-icon>login</mat-icon>
            <span>Log in</span>
          </button>
        }
        @if (appSettings.notificationsEnabled) {
          <button
            mat-icon-button
            class="toolbar-icon"
            [matMenuTriggerFor]="notificationsMenu"
            title="Notifications"
            aria-label="Notifications"
            (menuOpened)="markNotificationsRead()"
            [matBadge]="(unreadCount$ | async) ?? 0"
            [matBadgeHidden]="((unreadCount$ | async) ?? 0) === 0"
            matBadgeColor="warn"
            matBadgeSize="small">
            <mat-icon>notifications</mat-icon>
          </button>
        }
      </div>
    </div>
  </mat-toolbar>

  <mat-menu #notificationsMenu="matMenu">
    <button mat-menu-item disabled>
      <strong>Notifications</strong>
    </button>

    @if (notifications$ | async; as notifications) {
      @if (notifications.length === 0) {
        <button mat-menu-item disabled>
          <span>No notifications yet</span>
        </button>
      } @else {
        @for (notification of notifications; track notification.id) {
          <button mat-menu-item disabled>
            <span>{{ notification.message }}</span>
          </button>
        }
        <button mat-menu-item (click)="clearNotifications()">
          <mat-icon>delete_sweep</mat-icon>
          <span>Clear all</span>
        </button>
      }
    }
  </mat-menu>

  <div class="app-content">
    @if (currentView === 'tasks') {
      <mat-sidenav-container class="sidenav-container">
        <mat-sidenav mode="side" opened class="project-sidebar">
          <app-project-list (categorySelected)="taskBoard.loadTasks($event)"></app-project-list>
        </mat-sidenav>

        <mat-sidenav-content class="main-content">
          <app-task-board #taskBoard></app-task-board>
        </mat-sidenav-content>
      </mat-sidenav-container>
    }

    @if (currentView === 'users') {
      <div class="users-view">
        <app-user-management></app-user-management>
      </div>
    }

    @if (currentView === 'analytics') {
      <div class="users-view">
        <app-analytics-page></app-analytics-page>
      </div>
    }

    @if (currentView === 'settings') {
      <div class="users-view">
        <app-settings-page></app-settings-page>
      </div>
    }
  </div>
</div>
